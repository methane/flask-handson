# Flask を始めよう

## Flask の紹介

Flask は Python 製のマイクロフレームワークです。

マイクロフレームワークとは何でしょうか？

マイクロフレームワークの対義語はフルスタックフレームワークで、普通の
Webアプリケーションを作るのに必要なもの・便利なものをできるだけなんでも
用意したものになります。

マイクロフレームワークはその逆で、最低限必要なものや、ほぼすべてのWebアプリで
使う機能だけで構成されたフレームワークです。

マイクロフレームワークのフルスタックフレームワークに対する利点は、

1. 追加のツールを自分で選ぶのが簡単 (O/Rマッパー等)
2. フレームワークを覚えるだけで精一杯にならないで済む


## 環境構築

http://phpy.readthedocs.org/en/latest/install.html

を参照してください。

Flask もインストールしておきます。

Windows

```
> python -m easy_install Flask
```

Linux / Mac OS X

```
$ pip install Flask
```

## テキストエディタ

プログラミング向けのテキストエディタを用意してください。
文字コードには utf-8 を使えるものにしてください。

できれば、インデントはスペース4つにしておいてください。

## Flask で Hello, World!

Flask は簡単なWebアプリなら1ファイルで全て実装できます。

```python:hello.py
import flask

app = flask.Flask(__name__)

@app.route('/')
def index():
    return "Hello, World!"

app.run(debug=True)
```

このファイルを実行すると、 http://127.0.0.1:5000/ で Web サーバーが起動します。
ブラウザでアクセスすると、 Hello, World! の文字が見えるはずです。

## 解説

`import flask` という行は、 `flask` という名前のモジュールを読み込んで、 `flask`
という名前の変数に代入しています。
Python はモジュールやクラスなどは全てオブジェクトで、変数に代入して利用しています。

`app = flask.Flask(__name__)` という行は、 Flask クラスのオブジェクトを作って、
app という変数に代入しています。
オブジェクトの要素にアクセスする場合は、 `.` という記号を使って、
`オブジェクト名.要素名` のようにします。
モジュールの場合、クラスや関数などが要素になります。この場合、 flask モジュールが
提供している Flask クラスを利用していることになります。

Python でクラスのインスタンス化するときは、単にクラスを関数のように呼び出すだけで、
`new` などのキーワードや特別な構文はありません。
`__name__` というのは、自動的に定義される変数で、現在のファイルのモジュール名が入ります。
ファイルをスクリプトとして直接実行した場合、 `__name__` は `__main__` になります。

.. note::

    *from ... import ...* 構文

    `import flask` の代わりに、 `from flask import Flask` と書くと、 `flask.Flask` クラスを
    `Flask` という変数に代入します。この場合、 `app = flask.Flask(__name__)` の代わりに
    `app = Flask(__name__)` と書くことができます。

`@app.route('/')` という行は、 `app` に対して `/` というURLに対応するアクションを
登録しています。
`@` で始まる行はデコレータといって、その次の行で定義する関数やクラスに対して
任意の処理を実行します。 `app.route('/')` は、次の行で定義される関数を指定した
URL にマッピングするという処理を実行しています。

`def index():` という行は、関数定義を始めています。
次の行からのコードはインデントが一段深くなり、インデントが元に戻るまでの範囲が関数の中身になります。

`return 'Hello, World!'` は、 `'Hello, World!'` という文字列を返しています。
この関数がアクションとして実行されると、自動的にHTTPヘッダなどが付与されてクライアントに返されます。

最後の `app.run(debug=True)` という行は、 Flask が持っている開発用サーバーを、
デバッグモードで実行しています。
Python は関数の引数に `引数名=値` と書くことで、引数名を指定して引数を渡すことができます。
これは、たくさんデフォルト値付きのオプションがある関数で、特定のオプションだけを指定したい場合に便利です。
それ以外にも、引数の順番を間違えるというバグの予防にもなります。 (このバグはコードレビューしても
なかなか見つけられないので、簡単なわりに原因究明に数時間かかってしまうことがあります) 
